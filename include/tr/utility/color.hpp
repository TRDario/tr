#pragma once
#include "concepts.hpp"

namespace tr {
	/** @ingroup utility
	 *  @defgroup color Colors
	 *  Color datatypes and related functionality.
	 *  @{
	 */

	/******************************************************************************************************************
	 * Concept denoting a valid color datatype.
	 *
	 * To fulfill this, a type must be an arithmetic type taking up up to 4 bytes.
	 ******************************************************************************************************************/
	template <class T>
	concept color_datatype = (std::integral<T> || std::floating_point<T>) && sizeof(T) <= 4;

	/******************************************************************************************************************
	 * Single-channel red color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct r {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		constexpr friend bool operator==(const tr::r<T>&, const tr::r<T>&) = default;
	};

	/******************************************************************************************************************
	 * Single-channel green color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct g {
		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		constexpr friend bool operator==(const tr::g<T>&, const tr::g<T>&) = default;
	};

	/******************************************************************************************************************
	 * Single-channel blue color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct b {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		T b;

		constexpr friend bool operator==(const tr::b<T>&, const tr::b<T>&) = default;
	};

	/******************************************************************************************************************
	 * Two-channel RG color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct rg {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		constexpr friend bool operator==(const rg&, const rg&) = default;
	};

	/******************************************************************************************************************
	 * Three-channel RGB color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct rgb {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		T b;

		constexpr friend bool operator==(const rgb&, const rgb&) = default;
	};

	/******************************************************************************************************************
	 * Shorthand for the common 8-bit RGB color.
	 ******************************************************************************************************************/
	using rgb8 = rgb<u8>;

	/******************************************************************************************************************
	 * Shorthand for the common floating-point RGB color.
	 ******************************************************************************************************************/
	using rgbf = rgb<float>;

	/******************************************************************************************************************
	 * Three-channel BGR color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct bgr {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		T b;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		constexpr friend bool operator==(const bgr&, const bgr&) = default;
	};

	/******************************************************************************************************************
	 * Four-channel RGBA color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct rgba {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		T b;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		T a;

		/**************************************************************************************************************
		 * Default-constructs an RGBA value.
		 **************************************************************************************************************/
		constexpr rgba() = default;

		/**************************************************************************************************************
		 * Initializes an RGBA value.
		 *
		 * @param[in] r, g, b, a Channel values.
		 **************************************************************************************************************/
		constexpr rgba(T r, T g, T b, T a);

		/**************************************************************************************************************
		 * Initializes an RGBA value from an RGB value and an alpha channel.
		 *
		 * @param rgb The RGB values.
		 * @param[in] a The alpha channel value.
		 **************************************************************************************************************/
		constexpr rgba(rgb<T> rgb, T a);

		constexpr friend bool operator==(const rgba&, const rgba&) = default;

		constexpr rgba& operator+=(const rgba& r);
		constexpr rgba& operator-=(const rgba& r);
		template <arithmetic T1> constexpr rgba& operator*=(const T1& r);
		template <arithmetic T1> constexpr rgba& operator/=(const T1& r);
	};
	template <color_datatype T> constexpr rgba<T> operator+(const rgba<T>& l, const rgba<T>& r);
	template <color_datatype T> constexpr rgba<T> operator-(const rgba<T>& l, const rgba<T>& r);
	template <color_datatype T, arithmetic T1> constexpr rgba<T> operator*(const rgba<T>& l, const T1& r);
	template <color_datatype T, arithmetic T1> constexpr rgba<T> operator/(const rgba<T>& l, const T1& r);

	/******************************************************************************************************************
	 * Shorthand for the common 8-bit RGBA color.
	 ******************************************************************************************************************/
	using rgba8 = rgba<u8>;

	/******************************************************************************************************************
	 * Shorthand for the common floating-point RGBA color.
	 ******************************************************************************************************************/
	using rgbaf = rgba<float>;

	/******************************************************************************************************************
	 * Four-channel BGRA color.
	 *
	 * @tparam A valid color datatype.
	 ******************************************************************************************************************/
	template <color_datatype T> struct bgra {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		T b;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		T g;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		T r;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		T a;

		constexpr friend bool operator==(const bgra&, const bgra&) = default;
	};

	/******************************************************************************************************************
	 * Three-channel HSV color.
	 ******************************************************************************************************************/
	struct hsv {
		/**************************************************************************************************************
		 * The hue channel.
		 **************************************************************************************************************/
		float h;

		/**************************************************************************************************************
		 * The saturation channel.
		 **************************************************************************************************************/
		float s;

		/**************************************************************************************************************
		 * The value channel.
		 **************************************************************************************************************/
		float v;

		constexpr friend bool operator==(const hsv&, const hsv&) = default;
	};

	/******************************************************************************************************************
	 * Special packed RGB color format.
	 ******************************************************************************************************************/
	struct rgb8_223 {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u8 r : 2;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u8 g : 3;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u8 b : 3;

		constexpr friend bool operator==(const rgb8_223&, const rgb8_223&) = default;
	};

	/******************************************************************************************************************
	 * Special packed RGB color format.
	 ******************************************************************************************************************/
	struct rgb16_565 {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 6;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		constexpr friend bool operator==(const rgb16_565&, const rgb16_565&) = default;
	};

	/******************************************************************************************************************
	 * Special packed BGR color format.
	 ******************************************************************************************************************/
	struct bgr8_332 {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u8 b : 3;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u8 g : 3;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u8 r : 2;

		constexpr friend bool operator==(const bgr8_332&, const bgr8_332&) = default;
	};

	/******************************************************************************************************************
	 * Special packed BGR color format.
	 ******************************************************************************************************************/
	struct bgr16_565 {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 6;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		constexpr friend bool operator==(const bgr16_565&, const bgr16_565&) = default;
	};

	/******************************************************************************************************************
	 * Special packed RGBA color format.
	 ******************************************************************************************************************/
	struct rgba16_4444 {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 4;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 4;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 4;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 4;

		constexpr friend bool operator==(const rgba16_4444&, const rgba16_4444&) = default;
	};

	/******************************************************************************************************************
	 * Special packed RGBA color format.
	 ******************************************************************************************************************/
	struct rgba16_5551 {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 5;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 1;

		constexpr friend bool operator==(const rgba16_5551&, const rgba16_5551&) = default;
	};

	/******************************************************************************************************************
	 * Special packed RGBA color format.
	 ******************************************************************************************************************/
	struct rgba32_1010102 {
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u32 r : 10;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u32 g : 10;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u32 b : 10;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u32 a : 2;

		constexpr friend bool operator==(const rgba32_1010102&, const rgba32_1010102&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ABGR color format.
	 ******************************************************************************************************************/
	struct abgr16_4444 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 4;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 4;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 4;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 4;

		constexpr friend bool operator==(const abgr16_4444&, const abgr16_4444&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ABGR color format.
	 ******************************************************************************************************************/
	struct abgr16_1555 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 1;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 5;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		constexpr friend bool operator==(const abgr16_1555&, const abgr16_1555&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ABGR color format.
	 ******************************************************************************************************************/
	struct abgr32_2101010 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u32 a : 2;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u32 b : 10;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u32 g : 10;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u32 r : 10;

		constexpr friend bool operator==(const abgr32_2101010&, const abgr32_2101010&) = default;
	};

	/******************************************************************************************************************
	 * Special packed BGRA color format.
	 ******************************************************************************************************************/
	struct bgra16_4444 {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 4;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 4;
		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 4;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 4;

		constexpr friend bool operator==(const bgra16_4444&, const bgra16_4444&) = default;
	};

	/******************************************************************************************************************
	 * Special packed BGRA color format.
	 ******************************************************************************************************************/
	struct bgra16_5551 {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 5;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 1;

		constexpr friend bool operator==(const bgra16_5551&, const bgra16_5551&) = default;
	};

	/******************************************************************************************************************
	 * Special packed BGRA color format.
	 ******************************************************************************************************************/
	struct bgra32_1010102 {
		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u32 b : 10;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u32 g : 10;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u32 r : 10;

		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u32 a : 2;

		constexpr friend bool operator==(const bgra32_1010102&, const bgra32_1010102&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ARGB color format.
	 ******************************************************************************************************************/
	struct argb16_4444 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 4;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 4;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 4;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 4;

		constexpr friend bool operator==(const argb16_4444&, const argb16_4444&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ARGB color format.
	 ******************************************************************************************************************/
	struct argb16_1555 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u16 a : 1;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u16 r : 5;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u16 g : 5;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u16 b : 5;

		constexpr friend bool operator==(const argb16_1555&, const argb16_1555&) = default;
	};

	/******************************************************************************************************************
	 * Special packed ARGB color format.
	 ******************************************************************************************************************/
	struct argb32_2101010 {
		/**************************************************************************************************************
		 * The alpha channel.
		 **************************************************************************************************************/
		u32 a : 2;

		/**************************************************************************************************************
		 * The red channel.
		 **************************************************************************************************************/
		u32 r : 10;

		/**************************************************************************************************************
		 * The green channel.
		 **************************************************************************************************************/
		u32 g : 10;

		/**************************************************************************************************************
		 * The blue channel.
		 **************************************************************************************************************/
		u32 b : 10;

		constexpr friend bool operator==(const argb32_2101010&, const argb32_2101010&) = default;
	};

	/******************************************************************************************************************
	 * Concept denoting a built-in color type (as opposed to custom castable color types).
	 ******************************************************************************************************************/
	template <class T>
	concept built_in_color =
		specialization_of<T, r> || specialization_of<T, g> || specialization_of<T, b> || specialization_of<T, rg> ||
		specialization_of<T, rgb> || specialization_of<T, bgr> || specialization_of<T, rgba> || specialization_of<T, bgra> ||
		std::same_as<T, rgb8_223> || std::same_as<T, rgb16_565> || std::same_as<T, bgr8_332> || std::same_as<T, bgr16_565> ||
		std::same_as<T, rgba16_4444> || std::same_as<T, rgba16_5551> || std::same_as<T, rgba32_1010102> || std::same_as<T, abgr16_4444> ||
		std::same_as<T, abgr16_1555> || std::same_as<T, abgr32_2101010> || std::same_as<T, bgra16_4444> || std::same_as<T, bgra16_5551> ||
		std::same_as<T, bgra32_1010102> || std::same_as<T, argb16_4444> || std::same_as<T, argb16_1555> || std::same_as<T, argb32_2101010>;

	/// @}
} // namespace tr

////////////////////////////////////////////////////////////// IMPLEMENTATION /////////////////////////////////////////////////////////////

template <tr::color_datatype T>
constexpr tr::rgba<T>::rgba(T r, T g, T b, T a)
	: r{r}, g{g}, b{b}, a{a}
{
}

template <tr::color_datatype T>
constexpr tr::rgba<T>::rgba(rgb<T> rgb, T a)
	: r{rgb.r}, g{rgb.g}, b{rgb.b}, a{a}
{
}

template <tr::color_datatype T> constexpr tr::rgba<T>& tr::rgba<T>::operator+=(const rgba& v)
{
	r += v.r;
	g += v.g;
	b += v.b;
	a += v.a;
	return *this;
}

template <tr::color_datatype T> constexpr tr::rgba<T>& tr::rgba<T>::operator-=(const rgba& v)
{
	r -= v.r;
	g -= v.g;
	b -= v.b;
	a -= v.a;
	return *this;
}

template <tr::color_datatype T> template <tr::arithmetic T1> constexpr tr::rgba<T>& tr::rgba<T>::operator*=(const T1& v)
{
	r *= v;
	g *= v;
	b *= v;
	a *= v;
	return *this;
}

template <tr::color_datatype T> template <tr::arithmetic T1> constexpr tr::rgba<T>& tr::rgba<T>::operator/=(const T1& v)
{
	r /= v;
	g /= v;
	b /= v;
	a /= v;
	return *this;
}

template <tr::color_datatype T> constexpr tr::rgba<T> tr::operator+(const rgba<T>& l, const rgba<T>& r)
{
	return rgba<T>{l} += r;
}

template <tr::color_datatype T> constexpr tr::rgba<T> tr::operator-(const rgba<T>& l, const rgba<T>& r)
{
	return rgba<T>{l} -= r;
}

template <tr::color_datatype T, tr::arithmetic T1> constexpr tr::rgba<T> tr::operator*(const rgba<T>& l, const T1& r)
{
	return rgba<T>{l} *= r;
}

template <tr::color_datatype T, tr::arithmetic T1> constexpr tr::rgba<T> tr::operator/(const rgba<T>& l, const T1& r)
{
	return rgba<T>{l} /= r;
}
